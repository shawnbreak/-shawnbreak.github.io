<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-devops/openssh" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/02/02/devops/openssh/" class="article-date">
  <time class="dt-published" datetime="2022-02-02T14:31:24.860Z" itemprop="datePublished">2022-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/02/02/devops/openssh/">openssh</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="OpenSSH"><a href="#OpenSSH" class="headerlink" title="OpenSSH"></a>OpenSSH</h1><h2 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i ~/.ssh/id_rsa root@host</span><br></pre></td></tr></table></figure>

<h2 id="sshd"><a href="#sshd" class="headerlink" title="sshd"></a>sshd</h2><h2 id="ssh-config"><a href="#ssh-config" class="headerlink" title="ssh_config"></a>ssh_config</h2><h2 id="sshd-config"><a href="#sshd-config" class="headerlink" title="sshd_config"></a>sshd_config</h2><h2 id="ssh-agent"><a href="#ssh-agent" class="headerlink" title="ssh-agent"></a>ssh-agent</h2><p> OpenSSH authentication agent </p>
<p>windows</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Set-Service -Name ssh-agent -StartupType Manual</span><br><span class="line">Start-Service ssh-agent</span><br></pre></td></tr></table></figure>

<p>用途: </p>
<p>1.不需要用 -i 指定密钥，ssh-agent会帮我们选择</p>
<p>2.设置了pass phrase的话，不用每次都输入pass phrase, ssh-agent会帮我们记住</p>
<h2 id="ssh-add"><a href="#ssh-add" class="headerlink" title="ssh-add"></a>ssh-add</h2><p> adds private key identities to the OpenSSH authentication agent </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-add ~/.ssh/id_rsa <span class="comment"># 添加</span></span><br><span class="line">ssh-add -l <span class="comment"># 查看 </span></span><br><span class="line">ssh-add -d ~/.ssh/id_rsa <span class="comment"># 删除</span></span><br></pre></td></tr></table></figure>



<h2 id="sftp"><a href="#sftp" class="headerlink" title="sftp"></a>sftp</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sftp root@localhost</span><br><span class="line"></span><br><span class="line">get -r folder</span><br><span class="line">put -r folder</span><br></pre></td></tr></table></figure>



<h2 id="scp"><a href="#scp" class="headerlink" title="scp"></a>scp</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r /home/administrator/news.txt root@192.168.6.129:/etc/squid</span><br></pre></td></tr></table></figure>



<h2 id="ssh-keygen"><a href="#ssh-keygen" class="headerlink" title="ssh-keygen"></a>ssh-keygen</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen <span class="comment"># 默认配置,按提示输入信息</span></span><br><span class="line">ssh-keygen -t rsa -b 1024 -f filename -P passphrase -C <span class="string">&quot;comment&quot;</span></span><br></pre></td></tr></table></figure>



<p>安装公钥</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>



<h2 id="ssh-keyscan"><a href="#ssh-keyscan" class="headerlink" title="ssh-keyscan"></a>ssh-keyscan</h2><p> Utility for gathering public host keys from a number of hosts </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keyscan hostlist</span><br><span class="line">ssh-keyscan -t rsa hostlist</span><br></pre></td></tr></table></figure>



<h2 id="sftp-server"><a href="#sftp-server" class="headerlink" title="sftp-server"></a>sftp-server</h2><h2 id="ssh-keysign"><a href="#ssh-keysign" class="headerlink" title="ssh-keysign"></a>ssh-keysign</h2><h2 id="免密登录"><a href="#免密登录" class="headerlink" title="免密登录"></a>免密登录</h2><p>1.生成密钥对(在自己的电脑上)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure>

<p>2.添加到<code>~/.ssh/config</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line">	</span><br><span class="line">Host aliubuntu</span><br><span class="line">    HostName 39.108.88.198</span><br><span class="line">    Port 22</span><br><span class="line">    User root</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure>

<p>3.将公钥写到服务器~&#x2F;.ssh&#x2F;authorized_keys</p>
<p>4.服务器端设置sshd</p>
<p>&#x2F;etc&#x2F;ssh&#x2F;sshd_config</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 取消注释下面这行</span></span><br><span class="line">AuthorizedKeysFile      .ssh/authorized_keys .ssh/authorized_keys2</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart sshd</span><br></pre></td></tr></table></figure>

<ol start="5">
<li><p>现在可在自己的电脑上免密登录</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh aliubuntu</span><br><span class="line">sftp aliubuntu</span><br><span class="line">scp test.txt aliubuntu:~/</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="ssh-copy-id"><a href="#ssh-copy-id" class="headerlink" title="ssh-copy-id"></a>ssh-copy-id</h2><p>solution 1</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">choco install ssh-copy-id -y</span><br><span class="line">ssh-copy-id -i .ssh/id_rsa.pub root@host</span><br></pre></td></tr></table></figure>

<p>solution 2</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> .ssh/id_rsa.pub | ssh root@host <span class="string">&quot;cat &gt;&gt; .ssh/authorized_keys&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="端口转发"><a href="#端口转发" class="headerlink" title="端口转发"></a>端口转发</h2><h3 id="动态转发"><a href="#动态转发" class="headerlink" title="动态转发"></a>动态转发</h3><p>要访问的目标服务器不确定，端口也不确定。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh -D 2121 tunnel-host -N</span><br><span class="line"><span class="comment"># -D 动态转发</span></span><br><span class="line"><span class="comment"># -N 只转发，不登录shell</span></span><br></pre></td></tr></table></figure>

<p>采用socks5协议。</p>
<p>建立本地与ssh服务器的加密连接，将本地特定端口的访问都转发到ssh服务器。可以当作简单的代理服务器。</p>
<p>使用案例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -x socks5://localhost:2121 http://www.example.com</span><br></pre></td></tr></table></figure>



<h3 id="本地转发"><a href="#本地转发" class="headerlink" title="本地转发"></a>本地转发</h3><p>目标服务器的端口确定。</p>
<p>在本地执行转发命令。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 2121:www.example.com:80 tunnel-host -N</span><br><span class="line">curl http://localhost:2121</span><br></pre></td></tr></table></figure>

<p>访问本地2121端口跟访问<a target="_blank" rel="noopener" href="http://www.example.com/">www.example.com</a> 80端口效果一样。</p>
<h3 id="远程转发"><a href="#远程转发" class="headerlink" title="远程转发"></a>远程转发</h3><p>目标服务器的端口确定。</p>
<p>在远程（跳板机）执行转发命令。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 再跳板机执行</span></span><br><span class="line">ssh -R 2121:www.example.com:80 <span class="built_in">local</span> -N</span><br><span class="line"><span class="comment"># 在本地执行</span></span><br><span class="line">curl http://localhost:2121</span><br></pre></td></tr></table></figure>

<p>访问本地2121端口跟访问<a target="_blank" rel="noopener" href="http://www.example.com/">www.example.com</a> 80端口效果一样。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/02/02/devops/openssh/" data-id="ckz5ne7yn000c99ojhayv14kg" data-title="openssh" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-devops/ssh端口转发" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/02/02/devops/ssh%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/" class="article-date">
  <time class="dt-published" datetime="2022-02-02T14:31:24.860Z" itemprop="datePublished">2022-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/02/02/devops/ssh%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/">ssh 端口转发</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="ssh端口转发"><a href="#ssh端口转发" class="headerlink" title="ssh端口转发"></a>ssh端口转发</h1><h2 id="本地转发"><a href="#本地转发" class="headerlink" title="本地转发"></a>本地转发</h2><h2 id="远程转发"><a href="#远程转发" class="headerlink" title="远程转发"></a>远程转发</h2><h2 id="动态转发"><a href="#动态转发" class="headerlink" title="动态转发"></a>动态转发</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/02/02/devops/ssh%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/" data-id="ckz5ne7yo000d99ojgvdw7iyd" data-title="ssh 端口转发" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-devops/svn" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/02/02/devops/svn/" class="article-date">
  <time class="dt-published" datetime="2022-02-02T14:31:24.860Z" itemprop="datePublished">2022-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/02/02/devops/svn/">svn</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="svn"><a href="#svn" class="headerlink" title="svn"></a>svn</h1><p>[TOC]</p>
<h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><h3 id="svn-import"><a href="#svn-import" class="headerlink" title="svn import"></a>svn import</h3><p>把现有的项目导入到仓库中</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn import /myproject https://svn.example.com/svn/repo/project1</span><br></pre></td></tr></table></figure>

<h3 id="svn-list"><a href="#svn-list" class="headerlink" title="svn list"></a>svn list</h3><p>查看仓库文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn list https://svn.example.com/svn/project1</span><br></pre></td></tr></table></figure>

<h3 id="svn-checkout"><a href="#svn-checkout" class="headerlink" title="svn checkout"></a>svn checkout</h3><p>创建一个工作副本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn checkout https://svn.example.com/svn/project1/trunk</span><br></pre></td></tr></table></figure>

<h3 id="基本工作流"><a href="#基本工作流" class="headerlink" title="基本工作流"></a>基本工作流</h3><h4 id="svn-update"><a href="#svn-update" class="headerlink" title="svn update"></a>svn update</h4><p>拉取项目的最新更行</p>
<h4 id="svn-add-svn-delete-svn-copy-svn-move"><a href="#svn-add-svn-delete-svn-copy-svn-move" class="headerlink" title="svn add, svn delete, svn copy, svn move"></a>svn add, svn delete, svn copy, svn move</h4><p>项目编辑，更改等操作</p>
<h4 id="svn-status-svn-diff"><a href="#svn-status-svn-diff" class="headerlink" title="svn status, svn diff"></a>svn status, svn diff</h4><p>查看更改内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ svn status</span><br><span class="line">? scratch.c</span><br><span class="line">A stuff/loot</span><br><span class="line">A stuff/loot/new.c</span><br><span class="line">D stuff/old.c</span><br><span class="line">M bar.c</span><br></pre></td></tr></table></figure>

<p>?  item</p>
<p>​    没有加入版本控制的文件</p>
<p>A item</p>
<p>​    加如到仓库的文件，svn add的结果， svn commit后才生效</p>
<p>C item</p>
<p>​    冲突</p>
<p>D item</p>
<p>​    从仓库删除的文件， svn delete的结果，svn commit才生效</p>
<p>M item</p>
<p>​    被改变的文件</p>
<h4 id="svn-revert"><a href="#svn-revert" class="headerlink" title="svn revert"></a>svn revert</h4><p>回退错误的更改</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ svn status README</span><br><span class="line">M README</span><br><span class="line">$ svn revert README</span><br><span class="line">Reverted <span class="string">&#x27;README&#x27;</span></span><br><span class="line">$ svn status README</span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<h4 id="svn-update-svn-resolve"><a href="#svn-update-svn-resolve" class="headerlink" title="svn update, svn resolve"></a>svn update, svn resolve</h4><h4 id="svn-commit"><a href="#svn-commit" class="headerlink" title="svn commit"></a>svn commit</h4><h2 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h2><h3 id="创建分支"><a href="#创建分支" class="headerlink" title="创建分支"></a>创建分支</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ svn copy http://svn.example.com/repos/calc/trunk \</span><br><span class="line">http://svn.example.com/repos/calc/branches/my-calc-branch \</span><br><span class="line">-m <span class="string">&quot;Creating a private branch of /calc/trunk.&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="在分支上工作"><a href="#在分支上工作" class="headerlink" title="在分支上工作"></a>在分支上工作</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn checkout http://svn.example.com/repos/calc/branches/my-calc-branch</span><br></pre></td></tr></table></figure>

<h3 id="保持分支同步"><a href="#保持分支同步" class="headerlink" title="保持分支同步:"></a>保持分支同步:</h3><p>将主干的修改同步到分支</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/home/user/my-calc-branch</span><br><span class="line">$ svn merge ^/calc/trunk</span><br><span class="line">--- Merging r345 through r356 into <span class="string">&#x27;.&#x27;</span>:</span><br><span class="line">U button.c</span><br><span class="line">U integer.c</span><br><span class="line">--- Recording mergeinfo <span class="keyword">for</span> merge of r345 through r356 into <span class="string">&#x27;.&#x27;</span>:</span><br><span class="line">U .</span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<h3 id="将分支修改合并到主干"><a href="#将分支修改合并到主干" class="headerlink" title="将分支修改合并到主干"></a>将分支修改合并到主干</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/home/user/calc-trunk</span><br><span class="line">$ svn update <span class="comment"># (make sure the working copy is up to date)</span></span><br><span class="line">Updating <span class="string">&#x27;.&#x27;</span>:</span><br><span class="line">At revision 390.</span><br><span class="line">$ svn merge --reintegrate ^/calc/branches/my-calc-branch</span><br><span class="line">--- Merging differences between repository URLs into <span class="string">&#x27;.&#x27;</span>:</span><br><span class="line">U button.c</span><br><span class="line">U integer.c</span><br><span class="line">U Makefile</span><br><span class="line">--- Recording mergeinfo <span class="keyword">for</span> merge between repository URLs into <span class="string">&#x27;.&#x27;</span>:</span><br><span class="line">U .</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ <span class="comment"># build, test, verify, ...</span></span><br><span class="line">$ svn commit -m <span class="string">&quot;Merge my-calc-branch back into trunk!&quot;</span></span><br><span class="line">Sending .</span><br><span class="line">Sending button.c</span><br><span class="line">Sending integer.c</span><br><span class="line">Sending Makefile</span><br><span class="line">Transmitting file data ..</span><br><span class="line">Committed revision 391.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ svn delete ^/calc/branches/my-calc-branch \</span><br><span class="line">-m <span class="string">&quot;Remove my-calc-branch, reintegrated with trunk in r391.&quot;</span></span><br><span class="line">Committed revision 392.</span><br></pre></td></tr></table></figure>





<h2 id="svn仓库管理"><a href="#svn仓库管理" class="headerlink" title="svn仓库管理"></a>svn仓库管理</h2><h3 id="svn-仓库构成"><a href="#svn-仓库构成" class="headerlink" title="svn 仓库构成"></a>svn 仓库构成</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls repos</span><br><span class="line">conf/	db/  format/  hooks/  locks/  README.txt	</span><br></pre></td></tr></table></figure>

<p>conf&#x2F;</p>
<p>​        各种配置文件</p>
<p>db&#x2F;</p>
<p>​        版本控制的文件</p>
<p>format</p>
<p>​        描述仓库的结构</p>
<p>hooks&#x2F;</p>
<p>​        钩子脚本</p>
<p>locks&#x2F;</p>
<p>​        管理被锁的文件，访问控制</p>
<p>README.txt</p>
<p>​        简单说明</p>
<h3 id="推荐的项目结构"><a href="#推荐的项目结构" class="headerlink" title="推荐的项目结构"></a>推荐的项目结构</h3><p>&#x2F;</p>
<p>​    project&#x2F;</p>
<p>​            trunk&#x2F; (主要开发)</p>
<p>​            tags&#x2F; （快照，从不改变的）</p>
<p>​            branches&#x2F; (主要开发的分支)</p>
<h3 id="数据存储"><a href="#数据存储" class="headerlink" title="数据存储"></a>数据存储</h3><ul>
<li>Berkeley DB</li>
<li>FSFS（推荐）</li>
</ul>
<h3 id="创建和配置仓库"><a href="#创建和配置仓库" class="headerlink" title="创建和配置仓库"></a>创建和配置仓库</h3><h4 id="创建仓库"><a href="#创建仓库" class="headerlink" title="创建仓库"></a>创建仓库</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svnadmin create /var/svn/repos</span><br></pre></td></tr></table></figure>

<h4 id="实现钩子"><a href="#实现钩子" class="headerlink" title="实现钩子"></a>实现钩子</h4><p>pre-hooks</p>
<p>post-hooks</p>
<p>推荐实现方式：从现有模板copy一份修改</p>
<blockquote>
<p>注意：钩子的执行环境没有任何环境变量，所以都需要手动指定</p>
</blockquote>
<h3 id="仓库维护"><a href="#仓库维护" class="headerlink" title="仓库维护"></a>仓库维护</h3><h4 id="svnadmin"><a href="#svnadmin" class="headerlink" title="svnadmin"></a>svnadmin</h4><p>最基础的管理工具，包括仓库的创建等</p>
<h4 id="svnlook"><a href="#svnlook" class="headerlink" title="svnlook"></a>svnlook</h4><p>查看仓库的不同版本和事务，不会修改仓库</p>
<h4 id="svndumpfilter"><a href="#svndumpfilter" class="headerlink" title="svndumpfilter"></a>svndumpfilter</h4><p>仓库清理工具</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">svndumpfilter exclude</span><br><span class="line">svndumpfilter include</span><br></pre></td></tr></table></figure>



<h4 id="svnrdump"><a href="#svnrdump" class="headerlink" title="svnrdump"></a>svnrdump</h4><h4 id="svnsync"><a href="#svnsync" class="headerlink" title="svnsync"></a>svnsync</h4><p>同步一个只读的镜像仓库</p>
<h3 id="仓库配置"><a href="#仓库配置" class="headerlink" title="仓库配置"></a>仓库配置</h3><h4 id="svnserve"><a href="#svnserve" class="headerlink" title="svnserve"></a>svnserve</h4><p>最快，最简单</p>
<p>安全性不高，如果只是在局域网内使用够了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 服务端开始svn进程</span><br><span class="line">svnserv -d -r /var/svn</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 客户端使用</span><br><span class="line">svn checkout svn://host.example.com/project1</span><br></pre></td></tr></table></figure>





<h4 id="svnserve-over-ssh"><a href="#svnserve-over-ssh" class="headerlink" title="svnserve over ssh"></a>svnserve over ssh</h4><h4 id="The-apache-http-server"><a href="#The-apache-http-server" class="headerlink" title="The apache http server"></a>The apache http server</h4><p>有https加密，有apach日志系统</p>
<p>大项目，需要连接到互联网用这个</p>
<p>前提：httpd, mode_dav_svn</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/02/02/devops/svn/" data-id="ckz5ne7yp000e99ojfvme3cx1" data-title="svn" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-linux/HelloOS" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/02/02/linux/HelloOS/" class="article-date">
  <time class="dt-published" datetime="2022-02-02T14:31:24.860Z" itemprop="datePublished">2022-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/02/02/linux/HelloOS/">HelloOS</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="操作系统实战-HelloOS"><a href="#操作系统实战-HelloOS" class="headerlink" title="操作系统实战 HelloOS"></a>操作系统实战 HelloOS</h1><p>实验环境vmware ubunt20</p>
<h2 id="HelloOS下载与编译"><a href="#HelloOS下载与编译" class="headerlink" title="HelloOS下载与编译"></a>HelloOS下载与编译</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span></span><br><span class="line">make</span><br><span class="line">cp HellOS.bin /boot/</span><br></pre></td></tr></table></figure>



<h2 id="grub配置修改"><a href="#grub配置修改" class="headerlink" title="grub配置修改"></a>grub配置修改</h2><p>针对ubuntu20</p>
<p>首先，ubuntu20默认不显示grub界面，修改配置&#x2F;etc&#x2F;default&#x2F;grub</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GRUB_TIMEOUT-_STYLE=hidden</span></span><br><span class="line">GRUB_DEFAULT_TIMEOUT=30</span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=<span class="string">&quot;text&quot;</span></span><br></pre></td></tr></table></figure>

<p>添加menuentry, 在配置文件&#x2F;etc&#x2F;grub.d&#x2F;40_custom后追加</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">menuentry <span class="string">&#x27;HelloOS&#x27;</span> &#123;</span><br><span class="line">     insmod part_msdos <span class="comment">#GRUB加载分区模块识别分区</span></span><br><span class="line">     insmod ext2 <span class="comment">#GRUB加载ext文件系统模块识别ext文件系统</span></span><br><span class="line">     <span class="built_in">set</span> root=<span class="string">&#x27;hd0,msdos4&#x27;</span> <span class="comment">#注意boot目录挂载的分区，这是我机器上的情况</span></span><br><span class="line">     multiboot2 /boot/HelloOS.bin <span class="comment">#GRUB以multiboot2协议加载HelloOS.bin</span></span><br><span class="line">     boot <span class="comment">#GRUB启动HelloOS.bin</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使配置生效</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-grub</span><br></pre></td></tr></table></figure>



<blockquote>
<p>如果一开始忘记修改grub显示配置，会出现开机就是HelloOS，没有grub的引导界面。</p>
<p>此时可以用光盘启动，然后选择try ubuntu进入live cd模式。</p>
<p>进去后执行mount &#x2F;dev&#x2F;sda5 &#x2F;mnt，将系统挂载&#x2F;mnt目录，&#x2F;dev&#x2F;sda5是我安装目录</p>
<p>chroort &#x2F;mnt 切换到之前的系统工作，然后i需改grub配置文件即可</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/02/02/linux/HelloOS/" data-id="ckz5ne7yp000f99oj4uuaglmq" data-title="HelloOS" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-linux/Linux编程" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/02/02/linux/Linux%E7%BC%96%E7%A8%8B/" class="article-date">
  <time class="dt-published" datetime="2022-02-02T14:31:24.860Z" itemprop="datePublished">2022-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/02/02/linux/Linux%E7%BC%96%E7%A8%8B/">Linux编程</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Linux编程"><a href="#Linux编程" class="headerlink" title="Linux编程"></a>Linux编程</h1><h2 id="简单的模块"><a href="#简单的模块" class="headerlink" title="简单的模块"></a>简单的模块</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// filename: ex01_simple_module.c</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ex01_simple_module_init</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    printk(KERN_ALERT <span class="string">&quot;Inside the function %s\n&quot;</span>, __FUNCTION__);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ex01_simple_module_exit</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    printk(KERN_ALERT <span class="string">&quot;Inside the function %s\n&quot;</span>, __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(ex01_simple_module_init);</span><br><span class="line">module_exit(ex01_simple_module_exit);</span><br></pre></td></tr></table></figure>

<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj-m := ex01_simple_module.o</span><br></pre></td></tr></table></figure>



<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">make -C /lib/modules/$(uname -r)/build M=<span class="variable">$PWD</span> modules</span><br><span class="line">insmod ex01_simple_module.ko</span><br><span class="line">lsmod</span><br><span class="line">rmmod ex01_simple_module.ko</span><br><span class="line"></span><br><span class="line">dmesg</span><br></pre></td></tr></table></figure>








      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/02/02/linux/Linux%E7%BC%96%E7%A8%8B/" data-id="ckz5ne7yq000g99ojhmjve2ts" data-title="Linux编程" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-linux/Linux网卡命名规则" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/02/02/linux/Linux%E7%BD%91%E5%8D%A1%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99/" class="article-date">
  <time class="dt-published" datetime="2022-02-02T14:31:24.860Z" itemprop="datePublished">2022-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/02/02/linux/Linux%E7%BD%91%E5%8D%A1%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99/">Linx网卡命名规则</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Linux网卡命名规则"><a href="#Linux网卡命名规则" class="headerlink" title="Linux网卡命名规则"></a>Linux网卡命名规则</h1><p>一致的网络设备名以双字符前缀开始</p>
<ul>
<li><strong>en</strong>: 表示以太网设备（EtherNet）</li>
<li><strong>wl</strong>: 表示无线局域网设备（Wireless Lan）</li>
<li><strong>ww</strong>: 表示无线广域网设备（Wireless Wan）</li>
</ul>
<p>随后的第三个字符用于区分不同 的硬件类型</p>
<ul>
<li><strong>o</strong>: 表示主板板载设备（Onboard device）</li>
<li><strong>s</strong>: 表示热插拔插槽上的设备（hot-plug Slot）</li>
<li><strong>p</strong>: 表示PCI总线或USB接口上的设备（PCI device）</li>
</ul>
<p>下面是几个一致网络设备名及其说明</p>
<ul>
<li><strong>eno1677736</strong>: 板载的以太网设备（板载设备的索引编号为1677736）、</li>
<li><strong>enp0s8</strong>: PCI接口的以太网设备（PCI地址总线0，插槽编号为0）</li>
<li><strong>wlp12s0</strong>: PCI接口的无线局域网设备（PCI地址总线12，插槽编号0）</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/02/02/linux/Linux%E7%BD%91%E5%8D%A1%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99/" data-id="ckz5ne7yq000h99ojac2h0x1k" data-title="Linx网卡命名规则" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-linux/NetworkManager" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/02/02/linux/NetworkManager/" class="article-date">
  <time class="dt-published" datetime="2022-02-02T14:31:24.860Z" itemprop="datePublished">2022-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/02/02/linux/NetworkManager/">NetworkManager</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="NetworkManager"><a href="#NetworkManager" class="headerlink" title="NetworkManager"></a>NetworkManager</h1><h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install NetworkManager</span><br></pre></td></tr></table></figure>

<h2 id="Status"><a href="#Status" class="headerlink" title="Status"></a>Status</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status NetworkManager</span><br></pre></td></tr></table></figure>



<h2 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h2><ul>
<li>nmcli</li>
<li>nmtui</li>
<li>nm-connection-editor</li>
<li>control-centor</li>
<li>network connection icon</li>
</ul>
<h2 id="nmtui"><a href="#nmtui" class="headerlink" title="nmtui"></a>nmtui</h2><h2 id="nmcli"><a href="#nmcli" class="headerlink" title="nmcli"></a>nmcli</h2><h3 id="开始、停止网卡"><a href="#开始、停止网卡" class="headerlink" title="开始、停止网卡"></a>开始、停止网卡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nmcli con up id bond0</span><br><span class="line">nmcli con up id port0</span><br><span class="line">nmcli dev disconnect bond0</span><br><span class="line">nmcli dev disconnect ens3</span><br></pre></td></tr></table></figure>

<h3 id="帮助"><a href="#帮助" class="headerlink" title="帮助"></a>帮助</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli <span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<h3 id="交互式设置"><a href="#交互式设置" class="headerlink" title="交互式设置"></a>交互式设置</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli con edit ens33</span><br></pre></td></tr></table></figure>

<h3 id="添加或修改"><a href="#添加或修改" class="headerlink" title="添加或修改"></a>添加或修改</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli c add <span class="built_in">type</span> ethernet ifname enp1s0 con-name <span class="string">&quot;My Connection&quot;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli c modify <span class="string">&quot;My favorite connection&quot;</span> ethernet.mtu 1600</span><br></pre></td></tr></table></figure>



<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmcli con mod ens33 ipv4.dns <span class="string">&quot;114.114.114.114 8.8.8.8&quot;</span></span><br><span class="line">nmcli con mod ens33 ipv4.gateway <span class="string">&quot;192.168.86.2&quot;</span></span><br><span class="line">nmcli con up ens33 <span class="comment"># 使配置生效</span></span><br></pre></td></tr></table></figure>





<h3 id="wifi"><a href="#wifi" class="headerlink" title="wifi"></a>wifi</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nmcli dev wifi list</span><br><span class="line"></span><br><span class="line">nmcli con add con-name MyCafe ifname wlp61s0 <span class="built_in">type</span> wifi ssid MyCafe \</span><br><span class="line">ip4 192.168.100.101/24 gw4 192.168.100.1</span><br><span class="line"></span><br><span class="line">mcli con modify MyCafe wifi-sec.key-mgmt wpa-psk</span><br><span class="line">nmcli con modify MyCafe wifi-sec.psk caffeine</span><br><span class="line"></span><br><span class="line">nmcli radio wifi [on | off ]</span><br></pre></td></tr></table></figure>



<h2 id="设置路由"><a href="#设置路由" class="headerlink" title="设置路由"></a>设置路由</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection modify enp1s0 +ipv4.routes <span class="string">&quot;192.168.122.0/24 10.10.10.1&quot;</span></span><br></pre></td></tr></table></figure>





<h2 id="GUI"><a href="#GUI" class="headerlink" title="GUI"></a>GUI</h2><h3 id="nm-connection-editor"><a href="#nm-connection-editor" class="headerlink" title="nm-connection-editor"></a>nm-connection-editor</h3><p>在命令行执行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nm-connection-editor</span><br></pre></td></tr></table></figure>

<p>会弹出修改界面</p>
<h2 id="ip-command"><a href="#ip-command" class="headerlink" title="ip command"></a>ip command</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ip link <span class="built_in">set</span> ifname down</span><br><span class="line">ip address add 10.0.0.3/24 dev enp1s0</span><br><span class="line">ip addr show dev enp1s0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一块网卡配置多个ip</span></span><br><span class="line">ip address add 192.168.2.223/24 dev enp1s0</span><br><span class="line">ip address add 192.168.4.223/24 dev enp1s0</span><br></pre></td></tr></table></figure>



<h2 id="vlan-over-bond"><a href="#vlan-over-bond" class="headerlink" title="vlan over bond"></a>vlan over bond</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection add <span class="built_in">type</span> bond con-name Bond0 ifname bond0 bond.options <span class="string">&quot;mode=active-backup,miimon=100&quot;</span> ipv4.method disabled ipv6.method ignore</span><br><span class="line"></span><br><span class="line">nmcli connection add <span class="built_in">type</span> ethernet con-name Slave1 ifname em1 master bond0 slave-type bond</span><br><span class="line">nmcli connection add <span class="built_in">type</span> ethernet con-name Slave2 ifname em2 master bond0 slave-type bond</span><br><span class="line"></span><br><span class="line">nmcli connection add <span class="built_in">type</span> bridge con-name Bridge0 ifname br0 ip4 192.0.2.1/24</span><br><span class="line"></span><br><span class="line">nmcli connection add <span class="built_in">type</span> vlan con-name Vlan2 ifname bond0.2 dev bond0 id 2 master br0 slave-type bridge</span><br><span class="line"> </span><br><span class="line">nmcli connection show</span><br></pre></td></tr></table></figure>



<p>基线脚本片段</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [[ <span class="variable">$VLANID</span> != <span class="string">&quot;&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$BONDING_OPTS</span>&quot;</span> == <span class="string">&quot;&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">        cmd=<span class="string">&quot;nmcli connection add type bond con-name <span class="variable">$&#123;BONDING_NAME&#125;</span> ifname <span class="variable">$&#123;BONDING_NAME&#125;</span> bond.options \&quot;mode=<span class="variable">$&#123;BONDING_MODE&#125;</span>,miimon=100\&quot; ipv4.method disabled ipv6.method ignore&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        cmd=<span class="string">&quot;nmcli connection add type bond con-name <span class="variable">$&#123;BONDING_NAME&#125;</span> ifname <span class="variable">$&#123;BONDING_NAME&#125;</span> bond.options \&quot;<span class="variable">$&#123;BONDING_OPTS&#125;</span>\&quot; ipv4.method disabled ipv6.method ignore&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$cmd</span> | bash &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line">    nmcli connection add <span class="built_in">type</span> ethernet con-name Slave1 ifname <span class="variable">$&#123;NIC1&#125;</span> master <span class="variable">$&#123;BONDING_NAME&#125;</span> slave-type bond</span><br><span class="line">    nmcli connection add <span class="built_in">type</span> ethernet con-name Slave2 ifname <span class="variable">$&#123;NIC2&#125;</span> master <span class="variable">$&#123;BONDING_NAME&#125;</span> slave-type bond</span><br><span class="line">    nmcli connection add <span class="built_in">type</span> bridge con-name Bridge0 ifname br0 ipv4.addresses <span class="variable">$&#123;IP&#125;</span>/<span class="variable">$&#123;PREFIX&#125;</span> ipv4.gateway <span class="variable">$&#123;GATEWAY&#125;</span> ipv4.method manual</span><br><span class="line">    cmd=<span class="string">&quot;nmcli connection add type vlan con-name Vlan<span class="variable">$&#123;VLANID&#125;</span> ifname bond0<span class="variable">$&#123;VLANID&#125;</span> dev bond0 id <span class="variable">$&#123;VLANID&#125;</span> master br0 slave-type bridge&quot;</span></span><br><span class="line"><span class="keyword">else</span> </span><br></pre></td></tr></table></figure>



<h2 id="配置bond"><a href="#配置bond" class="headerlink" title="配置bond"></a>配置bond</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection add <span class="built_in">type</span> bond ifname <span class="variable">$&#123;BONDING_NAME&#125;</span> con-name <span class="variable">$&#123;BONDING_NAME&#125;</span> bond.options mode=<span class="variable">$&#123;BONDING_MODE&#125;</span> miimon=100</span><br><span class="line">nmcli connection add <span class="built_in">type</span> ethernet ifname <span class="variable">$&#123;NIC1&#125;</span>  master <span class="variable">$&#123;BONDING_NAME&#125;</span></span><br><span class="line">nmcli connection add <span class="built_in">type</span> ethernet ifname <span class="variable">$&#123;NIC2&#125;</span>  master <span class="variable">$&#123;BONDING_NAME&#125;</span></span><br><span class="line">nmcli connection mod <span class="variable">$&#123;BONDING_NAME&#125;</span> ipv4.addresses <span class="variable">$&#123;IP&#125;</span>/<span class="variable">$&#123;PREFIX&#125;</span> ipv4.gateway <span class="variable">$&#123;GATEWAY&#125;</span> ipv4.method manual</span><br><span class="line">nmcli connection modify <span class="variable">$&#123;BONDING_NAME&#125;</span> ipv4.dns \&quot;<span class="variable">$&#123;DNS&#125;</span>\&quot;</span><br></pre></td></tr></table></figure>




<h2 id="配置bond和vlan"><a href="#配置bond和vlan" class="headerlink" title="配置bond和vlan"></a>配置bond和vlan</h2><p>准备</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">modprobe --first-time 8021q</span><br><span class="line">modinfo 8021q</span><br></pre></td></tr></table></figure>

<p>配置bond</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nmcli con add <span class="built_in">type</span> bond ifname bond0 con-name bond0 mode 802.3ad miimon 100 downdelay 0 updelay 0 connection.autoconnect yes ipv4.method disabled ipv6.method ignore</span><br><span class="line"></span><br><span class="line">nmcli con add <span class="built_in">type</span> bond-slave ifname enP48p1s0f0 con-name enP48p1s0f0 master bond0</span><br><span class="line">nmcli con add <span class="built_in">type</span> bond-slave ifname enp1s0f0 con-name enp1s0f0 master bond0</span><br><span class="line"></span><br><span class="line">nmcli con up bond0</span><br></pre></td></tr></table></figure>

<p>配置vlan taggin</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmcli con add <span class="built_in">type</span> vlan ifname bond0.123 con-name bond0.123 id 123 dev bond0 connection.autoconnect yes ip4 192.168.123.123/24 gw4 192.168.123.1 ipv4.dns 192.168.123.4,192.168.123.5 ipv4.dns-search example.com</span><br><span class="line"></span><br><span class="line">nmcli con up bond0.123</span><br></pre></td></tr></table></figure>



<h2 id="配置bond，vlan和bridge"><a href="#配置bond，vlan和bridge" class="headerlink" title="配置bond，vlan和bridge"></a>配置bond，vlan和bridge</h2><p>配置bond</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection add <span class="built_in">type</span> bond con-name Bond0 ifname bond0 bond.options <span class="string">&quot;mode=active-backup,miimon=100&quot;</span> ipv4.method disabled ipv6.method ignore</span><br><span class="line"></span><br><span class="line">nmcli connection add <span class="built_in">type</span> ethernet con-name Slave1 ifname em1 master bond0 slave-type bond</span><br><span class="line">nmcli connection add <span class="built_in">type</span> ethernet con-name Slave2 ifname em2 master bond0 slave-type bond</span><br></pre></td></tr></table></figure>

<p>配置brigde</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection add <span class="built_in">type</span> bridge con-name Bridge0 ifname br0 ip4 192.0.2.1/24</span><br></pre></td></tr></table></figure>

<p>配置vlan tagging</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection add <span class="built_in">type</span> vlan con-name Vlan2 ifname bond0.2 dev bond0 id 2 master br0 slave-type bridge</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/02/02/linux/NetworkManager/" data-id="ckz5ne7yr000i99ojgtme45hf" data-title="NetworkManager" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-linux/Redhat7 HA" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/02/02/linux/Redhat7%20HA/" class="article-date">
  <time class="dt-published" datetime="2022-02-02T14:31:24.860Z" itemprop="datePublished">2022-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/02/02/linux/Redhat7%20HA/">Redhat7 HA</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="配置Redhat7高可用、浮动IP"><a href="#配置Redhat7高可用、浮动IP" class="headerlink" title="配置Redhat7高可用、浮动IP"></a>配置Redhat7高可用、浮动IP</h1><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>两台redhat7服务器: 192.168.10.9, 192.168.10.10</p>
<h2 id="配置-x2F-etc-x2F-hosts"><a href="#配置-x2F-etc-x2F-hosts" class="headerlink" title="配置&#x2F;etc&#x2F;hosts"></a>配置&#x2F;etc&#x2F;hosts</h2><p>各节点服务器分别执行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">192.168.10.9 node1</span><br><span class="line">192.168.10.10 node2</span><br></pre></td></tr></table></figure>

<p>检查</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping -c 3 node1</span><br><span class="line">ping -c 3 node2</span><br></pre></td></tr></table></figure>

<h2 id="配置高可用yum源"><a href="#配置高可用yum源" class="headerlink" title="配置高可用yum源"></a>配置高可用yum源</h2><p>各节点服务器分别执行</p>
<p>高可用软件在addons文件夹里面</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[HighAvailability]</span><br><span class="line">name=HighAvailability</span><br><span class="line">baseurl=file:///mnt/addons/HighAvailability</span><br><span class="line">gpgcheck=0</span><br><span class="line"><span class="built_in">enable</span>=1</span><br></pre></td></tr></table></figure>

<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>各节点服务器分别执行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install corosync pacemaker pcs</span><br></pre></td></tr></table></figure>

<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>配置开机自启动，各节点服务器分别执行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> pcsd</span><br><span class="line">systemctl <span class="built_in">enable</span> corosync</span><br><span class="line">systemctl <span class="built_in">enable</span> pacemaker</span><br></pre></td></tr></table></figure>

<p>启动，各节点服务器分别执行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start pcsd</span><br></pre></td></tr></table></figure>

<h2 id="配置高可用用户"><a href="#配置高可用用户" class="headerlink" title="配置高可用用户"></a>配置高可用用户</h2><p>各节点服务器分别执行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd hacluster</span><br></pre></td></tr></table></figure>

<h2 id="创建集群"><a href="#创建集群" class="headerlink" title="创建集群"></a>创建集群</h2><p>在node1上 执行即可</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 授权</span></span><br><span class="line">pcs cluster auth node1 node2</span><br><span class="line"><span class="comment"># 配置</span></span><br><span class="line">pcs cluster setup --name my_cluster node1 node2</span><br><span class="line"><span class="comment"># 启动</span></span><br><span class="line">pcs cluster start --all</span><br><span class="line">pcs cluster <span class="built_in">enable</span> --all</span><br></pre></td></tr></table></figure>

<p>检查状态</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pcs status cluster</span><br></pre></td></tr></table></figure>

<h2 id="关闭STONITH和Quorum-Policy"><a href="#关闭STONITH和Quorum-Policy" class="headerlink" title="关闭STONITH和Quorum Policy"></a>关闭STONITH和Quorum Policy</h2><p>在node1上 执行即可</p>
<blockquote>
<p>STONITH: Shoot The Other Node In The Head</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pcs property <span class="built_in">set</span> stonith-enabled=<span class="literal">false</span></span><br><span class="line">pcs property <span class="built_in">set</span> no-quorum-policy=ignore</span><br><span class="line">pcs property list</span><br></pre></td></tr></table></figure>

<h2 id="添加Resources"><a href="#添加Resources" class="headerlink" title="添加Resources"></a>添加Resources</h2><h3 id="查看Resouces"><a href="#查看Resouces" class="headerlink" title="查看Resouces"></a>查看Resouces</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pcs status resources</span><br></pre></td></tr></table></figure>

<h3 id="添加浮动IP"><a href="#添加浮动IP" class="headerlink" title="添加浮动IP"></a>添加浮动IP</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pcs resource create virtual_ip ocf:heartbeat:IPaddr2 ip=192.168.10.11 cidr_netmask=32 op monitor interval=30s</span><br></pre></td></tr></table></figure>

<h2 id="添加nginx"><a href="#添加nginx" class="headerlink" title="添加nginx"></a>添加nginx</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pcs resource create webserver ocf:heartbeat:nginx configfile=/etc/nginx/nginx.conf op monitor timeout=<span class="string">&quot;5s&quot;</span> interval=<span class="string">&quot;5s&quot;</span></span><br></pre></td></tr></table></figure>



<h2 id="配置Cluster-Constraint"><a href="#配置Cluster-Constraint" class="headerlink" title="配置Cluster Constraint"></a>配置Cluster Constraint</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pcs constraint colocation add webserver virtual_ip INFINITY</span><br><span class="line">pcs constraint order virtual_ip <span class="keyword">then</span> webserver</span><br></pre></td></tr></table></figure>

<h2 id="重启集群"><a href="#重启集群" class="headerlink" title="重启集群"></a>重启集群</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pcs cluster stop --all</span><br><span class="line">pcs cluster start --all</span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pcs cluster stop node1</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/02/02/linux/Redhat7%20HA/" data-id="ckz5ne7ys000j99ojbgsvb225" data-title="Redhat7 HA" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-linux/Systemd" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/02/02/linux/Systemd/" class="article-date">
  <time class="dt-published" datetime="2022-02-02T14:31:24.860Z" itemprop="datePublished">2022-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/02/02/linux/Systemd/">systemd</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Systemd"><a href="#Systemd" class="headerlink" title="Systemd"></a>Systemd</h1><p>[TOC]</p>
<p>Systemd是Linux系统工具，用来启动守护进程（daemon）。已成为大多数发行版的标准配置。</p>
<p>Systemd取代了initd，成为系统的第一个进程（PID等于1），其他的进程都是他的子进程。</p>
<h2 id="Systemd架构图"><a href="#Systemd架构图" class="headerlink" title="Systemd架构图"></a>Systemd架构图</h2><p><img src="/Images/bg2016030703.png" alt="img"></p>
<p>Systemd的优点是功能强大，使用方便，缺点是体系庞大，非常复杂。</p>
<h2 id="系统管理"><a href="#系统管理" class="headerlink" title="系统管理"></a>系统管理</h2><p>Systemd并不是一个命令，而是一组命令，涉及到系统管理的方方面面。</p>
<h3 id="systemctl"><a href="#systemctl" class="headerlink" title="systemctl"></a>systemctl</h3><p>Systemctl是Systemd的主命令，用于管理系统。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重启系统</span></span><br><span class="line">$ sudo systemctl reboot</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭系统，切断电源</span></span><br><span class="line">$ sudo systemctl poweroff</span><br><span class="line"></span><br><span class="line"><span class="comment"># CPU停止工作</span></span><br><span class="line">$ sudo systemctl halt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 暂停系统</span></span><br><span class="line">$ sudo systemctl <span class="built_in">suspend</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 让系统进入冬眠状态</span></span><br><span class="line">$ sudo systemctl hibernate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 让系统进入交互式休眠状态</span></span><br><span class="line">$ sudo systemctl hybrid-sleep</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动进入救援状态（单用户状态）</span></span><br><span class="line">$ sudo systemctl rescue</span><br></pre></td></tr></table></figure>

<h3 id="systemd-analyze"><a href="#systemd-analyze" class="headerlink" title="systemd-analyze"></a>systemd-analyze</h3><p><code>systemd-analyze</code>命令用于查看启动耗时。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看启动耗时</span></span><br><span class="line">$ systemd-analyze                                                                                       </span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看每个服务的启动耗时</span></span><br><span class="line">$ systemd-analyze blame</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示瀑布状的启动过程流</span></span><br><span class="line">$ systemd-analyze critical-chain</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示指定服务的启动流</span></span><br><span class="line">$ systemd-analyze critical-chain atd.service</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="hostnamectl"><a href="#hostnamectl" class="headerlink" title="hostnamectl"></a>hostnamectl</h3><p><code>hostnamectl</code>命令用于查看当前主机的信息。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示当前主机的信息</span></span><br><span class="line">$ hostnamectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置主机名。</span></span><br><span class="line">$ sudo hostnamectl set-hostname rhel7</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="journalctl"><a href="#journalctl" class="headerlink" title="journalctl"></a>journalctl</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">journalctl -b</span><br><span class="line">journalctl -b -1</span><br><span class="line">journalctl --list-boots</span><br><span class="line"></span><br><span class="line">journalctl --since <span class="string">&quot;1 hour ago&quot;</span></span><br><span class="line">journalctl --since <span class="string">&quot;2015-06-26 23:15:00&quot;</span> --until <span class="string">&quot;2015-06-26 23:20:00&quot;</span></span><br><span class="line">journalctl -u nginx.service</span><br><span class="line">journalctl -u nginx.service -u mysql.service</span><br><span class="line">journalctl -f</span><br><span class="line">journalctl -u mysql.service -f</span><br><span class="line">journalctl -n 50 --since <span class="string">&quot;1 hour ago&quot;</span></span><br><span class="line">journalctl -u sshd.service -r -n 1</span><br><span class="line">journalctl -u apache2.service -r -o json-pretty</span><br><span class="line">journalctl -b -1  -p <span class="string">&quot;emerg&quot;</span>..<span class="string">&quot;crit&quot;</span></span><br><span class="line">journalctl _UID=108</span><br></pre></td></tr></table></figure>



<h3 id="localectl"><a href="#localectl" class="headerlink" title="localectl"></a>localectl</h3><p><code>localectl</code>命令用于查看本地化设置。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看本地化设置</span></span><br><span class="line">$ localectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置本地化参数。</span></span><br><span class="line">$ sudo localectl set-locale LANG=en_GB.utf8</span><br><span class="line">$ sudo localectl set-keymap en_GB</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="timedatectl"><a href="#timedatectl" class="headerlink" title="timedatectl"></a>timedatectl</h3><p><code>timedatectl</code>命令用于查看当前时区设置。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前时区设置</span></span><br><span class="line">$ timedatectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有可用的时区</span></span><br><span class="line">$ timedatectl list-timezones                                                                                   </span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置当前时区</span></span><br><span class="line">$ sudo timedatectl set-timezone America/New_York</span><br><span class="line">$ sudo timedatectl set-time YYYY-MM-DD</span><br><span class="line">$ sudo timedatectl set-time HH:MM:SS</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="loginctl"><a href="#loginctl" class="headerlink" title="loginctl"></a>loginctl</h3><p><code>loginctl</code>命令用于查看当前登录的用户。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出当前session</span></span><br><span class="line">$ loginctl list-sessions</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出当前登录用户</span></span><br><span class="line">$ loginctl list-users</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出显示指定用户的信息</span></span><br><span class="line">$ loginctl show-user ruanyf</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="自定义systemd服务"><a href="#自定义systemd服务" class="headerlink" title="自定义systemd服务"></a>自定义systemd服务</h2><p>文件名以.service结尾，放在&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;, &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F; 目录下。</p>
<p>文件内容一般包含三个部分：</p>
<ul>
<li>Unit: 定义service的一些基本信息， description, after</li>
<li>Service: 定义服务的启动和停止命令，类型等</li>
<li>Install: 服务的运行级别</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=custom service</span><br><span class="line">after=network.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">User=<span class="built_in">test</span></span><br><span class="line">Group=<span class="built_in">test</span></span><br><span class="line">ExecStart=/bin/app start</span><br><span class="line">Restart=always</span><br><span class="line">SuccessExitStatus=KILL</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://www.freedesktop.org/software/systemd/man/systemd.service.html">https://www.freedesktop.org/software/systemd/man/systemd.service.html</a></p>
<h2 id="type-forking-simple"><a href="#type-forking-simple" class="headerlink" title="type forking, simple"></a>type forking, simple</h2><p>Type&#x3D;forking<br>systemd认为当该服务进程fork，且父进程退出后服务启动成功。对于常规的守护进程（daemon），除非你确定此启动方式无法满足需求，使用此类型启动即可。使用此启动类型应同时指定 PIDFile&#x3D;，以便 systemd 能够跟踪服务的主进程<br>Type&#x3D;simple<br>systemd认为该服务将立即启动。服务进程不会 fork 。如果该服务要启动其他服务，不要使用此类型启动，除非该服务是socket 激活型。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/02/02/linux/Systemd/" data-id="ckz5ne7ys000k99oj87prbu17" data-title="systemd" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-linux/centos7" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/02/02/linux/centos7/" class="article-date">
  <time class="dt-published" datetime="2022-02-02T14:31:24.860Z" itemprop="datePublished">2022-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/02/02/linux/centos7/">centos7</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Centos-7"><a href="#Centos-7" class="headerlink" title="Centos 7"></a>Centos 7</h1><h2 id="SELinux"><a href="#SELinux" class="headerlink" title="SELinux"></a>SELinux</h2><p>关闭SELinux</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sestatus</span><br><span class="line"><span class="built_in">set</span> enforce 0 <span class="comment">#permissive</span></span><br><span class="line">/etc/selinux/config</span><br><span class="line"><span class="comment"># SELinux=enforcing</span></span><br><span class="line"><span class="comment"># SELinux=permissive</span></span><br><span class="line">SELinux=disabled</span><br></pre></td></tr></table></figure>

<h2 id="Firewalld"><a href="#Firewalld" class="headerlink" title="Firewalld"></a>Firewalld</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --status</span><br><span class="line">systemctl status firewalld</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure>



<h2 id="yum-源"><a href="#yum-源" class="headerlink" title="yum 源"></a>yum 源</h2><p>下载源配置文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br></pre></td></tr></table></figure>

<p>修改源配置文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/CentOS-Base.repo </span><br></pre></td></tr></table></figure>

<p>打开文件后将版本号改为7即可</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s/<span class="variable">$releaserver</span>/7/g</span><br></pre></td></tr></table></figure>

<p>更新即可</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum clean all </span><br><span class="line">yum makecache</span><br><span class="line">yum update</span><br></pre></td></tr></table></figure>



<p>报错：initscripts conflicts with redhat-release-server-7.4-18.el7.x86_64</p>
<p>解决1：删除冲突包</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -e redhat-release-server-7.4-18.el7.x86_64 --nodeps</span><br></pre></td></tr></table></figure>



<p>解决2(推荐)：阻止更新内核 initscripts</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.conf</span><br></pre></td></tr></table></figure>

<p>追加以下内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exclude=kernel*</span><br><span class="line">exclude=centos-release*</span><br><span class="line">exclude=initscripts</span><br></pre></td></tr></table></figure>





<h2 id="Centos-7-配置Samba"><a href="#Centos-7-配置Samba" class="headerlink" title="Centos 7 配置Samba"></a>Centos 7 配置Samba</h2><ul>
<li>安装</li>
</ul>
<p>将本地iso配置为yum源</p>
<p>使用yum安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install samba -y</span><br></pre></td></tr></table></figure>

<ul>
<li>配置</li>
</ul>
<p>在配置文件中<code>/etc/samba/smb.conf</code>追加如下内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[hmcsdata]</span><br><span class="line">	path=/home/heming/hmcsdata</span><br><span class="line">	writeable=yes</span><br></pre></td></tr></table></figure>



<ul>
<li>创建共享目录和共享用户</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /home/heming/hmcsdata <span class="comment"># 创建共享目录</span></span><br><span class="line">groupadd sambashare <span class="comment"># 闯将共享用户组</span></span><br><span class="line">chgrp sambashare /home/heming/hmcsdata <span class="comment"># 将共享目录的用户组改为sambashare</span></span><br><span class="line">useradd -s /usr/sbin/nologin -G sambashare josh <span class="comment"># 创建共享用户</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>-M</code> -do not create the user’s home directory. We’ll manually create this directory.</p>
<p><code>-d /samba/josh</code> - set the user’s home directory to <code>/samba/josh</code>.</p>
<p><code>-s /usr/sbin/nologin</code> - disable shell access for this user.</p>
<p><code>-G sambashare</code> - add the user to the <code>sambashare</code> group.</p>
</blockquote>
<ul>
<li>启用共享用户</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">smbpasswd -a josh <span class="comment"># 将用户添加（add）到samba配置</span></span><br><span class="line">smbpasswd -e josh <span class="comment"># 启用（enable）用户</span></span><br></pre></td></tr></table></figure>

<h2 id="mail"><a href="#mail" class="headerlink" title="mail"></a>mail</h2><p>安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ubuntu</span></span><br><span class="line">sudo apt-get install heirloom-mailx</span><br><span class="line"></span><br><span class="line"><span class="comment"># centos</span></span><br><span class="line">yum install -y mailx </span><br></pre></td></tr></table></figure>

<p>添加配置</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ubuntu</span></span><br><span class="line">vim /etc/nail.rc</span><br><span class="line"><span class="comment"># centos</span></span><br><span class="line">vim /etc/mail.rc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> from=mail@qq.com</span><br><span class="line"><span class="built_in">set</span> smtp=smtp.exmail.qq.com</span><br><span class="line"><span class="built_in">set</span> smtp-auth-user=mail@qq.com</span><br><span class="line"><span class="built_in">set</span> smtp-auth-password=123456</span><br><span class="line"><span class="built_in">set</span> smtp-auth=login</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span>  <span class="string">&quot;MAIL-BODY&quot;</span> | mail -s <span class="string">&quot;Title&quot;</span> 123@qq.com,345@qq.com</span><br></pre></td></tr></table></figure>

<h2 id="GNOME图形化界面"><a href="#GNOME图形化界面" class="headerlink" title="GNOME图形化界面"></a>GNOME图形化界面</h2><ol>
<li>root模式</li>
<li>安装 X Windows System</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall <span class="string">&quot;X Window System&quot;</span> -y</span><br><span class="line">yum grouplist <span class="comment"># 查看已经安装的软件</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>安装gnome</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall <span class="string">&quot;GNOME Desktop&quot;</span> <span class="string">&quot;Graphical Administration Tools&quot;</span> -y</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>启动图形化界面</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reboot <span class="comment"># 先重启</span></span><br><span class="line">startx</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>系统的默认启动界面还是命令行，更改为启动为图形界面执行下面的命令</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -sf /lib/systemd/system/runlevel5.target /etc/systemd/system/default.target</span><br></pre></td></tr></table></figure>

<h2 id="XFCE-图形界面安装"><a href="#XFCE-图形界面安装" class="headerlink" title="XFCE 图形界面安装"></a>XFCE 图形界面安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum grouplist <span class="comment"># 查看可用安装组</span></span><br><span class="line">yum groupinstall <span class="string">&quot;X Window system&quot;</span></span><br><span class="line">yum groupinstall xfce</span><br><span class="line"></span><br><span class="line">systemctl isolate graphical.target <span class="comment"># 启动</span></span><br><span class="line">systemctl set-default graphical.target <span class="comment"># 设置默认启动</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install cjkuni* -y <span class="comment"># 安装中文字体</span></span><br><span class="line">yum install google-noto-sans-simplified-chinese-fonts.noarch</span><br></pre></td></tr></table></figure>



<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装输入法，待验证</span></span><br><span class="line">yum install -y ibus ibus-libpinyin ibus-gtk2 ibus-gtk3 im-chooser gtk2-immodule-xim gtk3-immodule-xim</span><br><span class="line"></span><br><span class="line">im-chooser</span><br></pre></td></tr></table></figure>



<h2 id="Redhat-7-远程桌面方案"><a href="#Redhat-7-远程桌面方案" class="headerlink" title="Redhat 7 远程桌面方案"></a>Redhat 7 远程桌面方案</h2><blockquote>
<p>前提：Redhat 7 已经安装了桌面环境 X Window System和Gnome或Xfce或KDE</p>
</blockquote>
<h3 id="VNC"><a href="#VNC" class="headerlink" title="VNC"></a>VNC</h3><h3 id="XRDP"><a href="#XRDP" class="headerlink" title="XRDP"></a>XRDP</h3><blockquote>
<p>an open-source Remote Desktop Protocol server</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">yum install epel-release -y</span><br><span class="line">yum install xrdp -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置开机自启并启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> xrdp</span><br><span class="line">systemctl <span class="built_in">enable</span> xrdp-sesman</span><br><span class="line">systemctl start xrdp-sesman</span><br><span class="line">systemctl start xrdp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启防火墙</span></span><br><span class="line">firewall-cmd --permanent --zone=public --add-port=3389/tcp</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<h2 id="yum-download-only"><a href="#yum-download-only" class="headerlink" title="yum download only"></a>yum download only</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install yum-plugin-downloadonly </span><br><span class="line">yum install httpd httpd-devel --downloadonly --downloaddir=/home/httpd</span><br></pre></td></tr></table></figure>

<h2 id="单网卡多IP设置"><a href="#单网卡多IP设置" class="headerlink" title="单网卡多IP设置"></a>单网卡多IP设置</h2><h3 id="方法1：通过网卡配置文件配置多个IP"><a href="#方法1：通过网卡配置文件配置多个IP" class="headerlink" title="方法1：通过网卡配置文件配置多个IP"></a>方法1：通过网卡配置文件配置多个IP</h3><p>vim &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-ens33</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">NAME=eno16777736</span><br><span class="line">DEVICE=eno16777736</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR0=10.91.137.66</span><br><span class="line">PREFIX0=27</span><br><span class="line">GATEWAY0=10.91.137.65        </span><br><span class="line"><span class="comment">#####################</span></span><br><span class="line">IPADDR1=192.168.100.2             </span><br><span class="line">PREFIX1=24      </span><br></pre></td></tr></table></figure>

<blockquote>
<p>可通过nmtui运行命令行图形化界面配置</p>
</blockquote>
<h3 id="方法2：-通过网卡别名配置多个IP"><a href="#方法2：-通过网卡别名配置多个IP" class="headerlink" title="方法2： 通过网卡别名配置多个IP"></a>方法2： 通过网卡别名配置多个IP</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/sysconfig/network-scripts/ifcfg-ens33 /etc/sysconfig/network-scripts/ifcfg-ens33:0</span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-ens33:0</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">NAME=eno16777736:0</span><br><span class="line">DEVICE=eno16777736:0</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.100.3</span><br><span class="line">NETMASK=255.255.255.0</span><br></pre></td></tr></table></figure>



<h2 id="开启telnet服务"><a href="#开启telnet服务" class="headerlink" title="开启telnet服务"></a>开启telnet服务</h2><ul>
<li><p>检查是否安装telnet和xinetd</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep telnet</span><br><span class="line">rpm -qa | grep xinetd</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装<code>telnet</code>，<code>xinetd</code>服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install xinetd telnet telnet-server -y</span><br></pre></td></tr></table></figure>


</li>
<li><p>启动 <code>telnet</code>服务</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置开机自启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> telnet.socket</span><br><span class="line">systemctl <span class="built_in">enable</span> xinetd</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动telnet</span></span><br><span class="line">systemctl start telnet.socket</span><br><span class="line">systemctl start xinetd</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看telnet的服务状态</span></span><br><span class="line">systemctl status telnet.socket</span><br><span class="line">systemctl status xinetd</span><br></pre></td></tr></table></figure>

<ul>
<li>防火墙开放 <code>telnet</code>服务端口</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/lib/firewalld/services</span><br><span class="line">vim tel.xml</span><br></pre></td></tr></table></figure>

<p>写入以下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">service</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">short</span>&gt;</span>Telnet<span class="tag">&lt;/<span class="name">short</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Telnet is a protocol for logging into remote machines. It is unencrypted, and provides little security from network snooping attacks. Enabling telnet is not recommended. You need the telnet-server package installed for this option to be useful.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">port</span>=<span class="string">&quot;23&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;tcp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在终端键入以下命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-service=telnet --zone=public --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<blockquote>
<p>查看防火墙是否开启<code>telnet</code>服务端口的命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;firewall-cmd --list-services</span><br></pre></td></tr></table></figure>


</blockquote>
<ul>
<li>关闭<code>telnet</code>服务</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop telnet.socket</span><br><span class="line">systemctl stop xinetd</span><br><span class="line">firewall-cmd --remove-service=telnet --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>





<h1 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h1><h2 id="非root用户绑定低端口问题"><a href="#非root用户绑定低端口问题" class="headerlink" title="非root用户绑定低端口问题"></a>非root用户绑定低端口问题</h2><h3 id="解决1：-cap-net-bind-service"><a href="#解决1：-cap-net-bind-service" class="headerlink" title="解决1： cap_net_bind_service"></a>解决1： cap_net_bind_service</h3><p>setcap ‘cap_net_bind_service&#x3D;+ep’ &#x2F;usr&#x2F;java&#x2F;jdk1.8.0_241-amd64&#x2F;jre&#x2F;bin&#x2F;java<br>setcap -r &#x2F;usr&#x2F;java&#x2F;jdk1.8.0_241-amd64&#x2F;jre&#x2F;bin&#x2F;java<br>注意：<br>1、Linux的内核版本必须不低于2.6.24<br>2、针对脚本不起作用，只能是ELF可执行文件<br>3、会禁用程序的LD_LIBRARY_PATH变量<br>java有自己的LD_LIBRARY_PATH变量，所以这招行不通</p>
<h3 id="解决2：端口转发"><a href="#解决2：端口转发" class="headerlink" title="解决2：端口转发"></a>解决2：端口转发</h3><h3 id="解决3：authbind"><a href="#解决3：authbind" class="headerlink" title="解决3：authbind"></a>解决3：authbind</h3><p>github:<a target="_blank" rel="noopener" href="https://github.com/tootedom/authbind-centos-rpm">https://github.com/tootedom/authbind-centos-rpm</a><br>参考博客： <a target="_blank" rel="noopener" href="https://beproud.wordpress.com/2019/04/19/install-tomcat-in-centos-port-80-443/">https://beproud.wordpress.com/2019/04/19/install-tomcat-in-centos-port-80-443/</a></p>
<h2 id="java非root用户调用InetAddress-isReachable-失败问题"><a href="#java非root用户调用InetAddress-isReachable-失败问题" class="headerlink" title="java非root用户调用InetAddress.isReachable()失败问题"></a>java非root用户调用InetAddress.isReachable()失败问题</h2><p> Linux non-root user call java InetAddress.isReachable()<br>为什么Linux非root用户调用java的InetAddress.isReachable()会失败？<br>java中的InetAddress.isReachable()是通调用Linux的系统调用来实现的，然而Linux的系统调用是需要root权限的，所以会失败。<br>参考回答：<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/2777226/isreachable-in-java-doesnt-appear-to-be-working-quite-the-way-its-supposed-to">https://stackoverflow.com/questions/2777226/isreachable-in-java-doesnt-appear-to-be-working-quite-the-way-its-supposed-to</a><br>参考博客：<a target="_blank" rel="noopener" href="https://bordet.blogspot.com/2006/07/icmp-and-inetaddressisreachable.html">https://bordet.blogspot.com/2006/07/icmp-and-inetaddressisreachable.html</a></p>
<p>解决1：直接调用系统提供ping程序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Process p1 = java.lang.Runtime.getRuntime().exec(<span class="string">&quot;ping -c 1 www.google.com&quot;</span>);</span><br><span class="line"><span class="keyword">int</span> returnVal = p1.waitFor();</span><br><span class="line"><span class="keyword">boolean</span> reachable = (returnVal==<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>说明：ping有suid权限，任何人调用这个程序的暂时有root的权限</p>
<h2 id="U盘安装启动问题问题"><a href="#U盘安装启动问题问题" class="headerlink" title="U盘安装启动问题问题"></a>U盘安装启动问题问题</h2><p>制作Linux启动U盘时，U盘格式为FAT32，U盘名字的长度有限制。</p>
<p>如<code>RHEL-7.4 Server.x86_64</code>，grub的安装启动参数中只能读到&#96;&#96;RHEL-7_4\20SE&#96;，因此会导致安装的时候找不到安装源。</p>
<p>解决方案有两种（亲测有效）</p>
<ol>
<li><p>改U盘名字（LABEL方式启动）</p>
<p>制作完启动U盘后，将其名字改短，如<code>RHEL</code></p>
<p>启动界面按<kbd>e</kbd>编辑安装启动参数，将<code>inst.stage2=hd:LABEL=RHEL-7_4\20SE quiet</code>改为 <code>inst.stage2=hd:LABEL=RHEL quiet</code></p>
</li>
<li><p>直接用<code>/dev/sdb4</code>启动</p>
<p>不改名字直接启动会报错，然后几分钟后会进入dracut。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /dev</span><br></pre></td></tr></table></figure>

<p>可以看到有 <code>sda sda1 sdb sdb1 sdb2</code>等等</p>
<p>找到你U盘对应的那一个，一般来说为sd开头的最后一个，不确定可以挂载看看里面的内容。</p>
<p>然后执行<code>reboot</code>命令重启。</p>
<p>启动界面按<kbd>e</kbd>编辑安装启动参数，将<code>inst.stage2=hd:LABEL=RHEL-7_4\20SE quiet</code>改为 <code>inst.stage2=hd:/dev/sdb4 quiet</code>（注意不一定是sdb4，根据具体情况）</p>
</li>
</ol>
<h2 id="启动报错"><a href="#启动报错" class="headerlink" title="启动报错"></a>启动报错</h2><p> Failed to open \efi\centos\grubx64.efi - not found </p>
<p>解决方案：用启动盘进入急救模式，将启动盘中的grubx64.efi文件拷到 对应目录下即可</p>
<h2 id="重启进入grub"><a href="#重启进入grub" class="headerlink" title="重启进入grub"></a>重启进入grub</h2><p>环境：redhat 7.4， minimal install + X Window system + xfce</p>
<p>问题描述：换yum源后yum update，然后重启进入grub模式。启动选项有一个centos和一个redhat。</p>
<p>解决：急救模式下，将 &#x2F;boot&#x2F;efi&#x2F;EFI&#x2F;redhat&#x2F;grub.cfg拷到 &#x2F;boot&#x2F;efi&#x2F;EFI&#x2F;centos&#x2F;然后重启即可</p>
<h1 id="重装yum"><a href="#重装yum" class="headerlink" title="重装yum"></a>重装yum</h1><blockquote>
<p><del>背景：redhat 7 没有redhat账户不能用</del></p>
<p>只要配置对应的yum源就行，不需要重装yum</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | greap yum</span><br><span class="line"><span class="comment"># 删除原本的yum文件</span></span><br><span class="line">rpm -qa | grep yum | xargs rpm -e --nodeps</span><br></pre></td></tr></table></figure>
<p>去阿里镜像站下载五个文件（对应版本的目录下）<br><a target="_blank" rel="noopener" href="https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/">https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/</a></p>
<p>yum-metadata-parser<br>yum<br>yum-plugin-fastestmirror<br>yum-utils<br>python-urlgrabber</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-metadata-parser-1.1.4-10.el7.x86_64.rpm</span><br><span class="line">wget https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-3.4.3-158.el7.centos.noarch.rpm</span><br><span class="line">wget https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-plugin-fastestmirror-1.1.31-45.el7.noarch.rpm</span><br><span class="line">wget https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-utils-1.1.31-45.el7.noarch.rpm</span><br><span class="line">wget https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/python-urlgrabber-3.10-8.el7.noarch.rpm  </span><br></pre></td></tr></table></figure>

<p>安装，加上 –force强制安装（解决依赖问题）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh xxx1.rpm xxx2.rpm xxx3.rpm xxx4.rpm xxx5.rpm --force --nodeps</span><br></pre></td></tr></table></figure>

<p>阿里镜像yum源</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">wget-O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br></pre></td></tr></table></figure>

<p>修改版本号</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/CentOS-Base.repo </span><br><span class="line"></span><br><span class="line">:%s/<span class="variable">$releaserver</span>/7/g</span><br></pre></td></tr></table></figure>

<p>最后</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum clean all </span><br><span class="line">yum makecache</span><br><span class="line">yum update</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/02/02/linux/centos7/" data-id="ckz5ne7yt000l99oj1e8s9wvm" data-title="centos7" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/02/02/linux/clash/">clash</a>
          </li>
        
          <li>
            <a href="/2022/02/02/linux/dhcp/">dhcp</a>
          </li>
        
          <li>
            <a href="/2022/02/02/linux/redhat7.4%20%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">Redhat 开发环境配置</a>
          </li>
        
          <li>
            <a href="/2022/02/02/linux/shc/">shc</a>
          </li>
        
          <li>
            <a href="/2022/02/02/linux/shell/">shell</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>